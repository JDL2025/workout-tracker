<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Workout Tracker">
    <link rel="manifest" href="manifest.json">
    <title>üèãÔ∏è Workout Tracker</title>
    <style>
        :root {
            /* Light Mode Colors */
            --bg-gradient-start: #667eea;
            --bg-gradient-end: #764ba2;
            --bg-card: #ffffff;
            --bg-input: #ffffff;
            --text-primary: #333333;
            --text-secondary: #666666;
            --text-light: #999999;
            --border-color: #e0e0e0;
            --border-light: #ddd;
            --shadow-color: rgba(0, 0, 0, 0.1);
            --button-primary: #667eea;
            --button-hover: #5568d3;
            --button-active: #4a5abf;
            --success-bg: #d4edda;
            --success-text: #155724;
            --error-bg: #f8d7da;
            --error-text: #721c24;
            --highlight-bg: #c8e6c9;
            --highlight-border: #4caf50;
            --info-bg: #e3f2fd;
            --info-text: #1976d2;
        }

        [data-theme="dark"] {
            /* Dark Mode Colors */
            --bg-gradient-start: #1a1a2e;
            --bg-gradient-end: #16213e;
            --bg-card: #2a2a3e;
            --bg-input: #1f1f2e;
            --text-primary: #e0e0e0;
            --text-secondary: #b0b0b0;
            --text-light: #808080;
            --border-color: #404050;
            --border-light: #505060;
            --shadow-color: rgba(0, 0, 0, 0.3);
            --button-primary: #7b8fd4;
            --button-hover: #8a9ee0;
            --button-active: #6a7fc0;
            --success-bg: #1e4620;
            --success-text: #90ee90;
            --error-bg: #4a1f1f;
            --error-text: #ff6b6b;
            --highlight-bg: #2d4a2f;
            --highlight-border: #66bb6a;
            --info-bg: #1e3a5f;
            --info-text: #64b5f6;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, var(--bg-gradient-start) 0%, var(--bg-gradient-end) 100%);
            min-height: 100vh;
            padding: 10px;
            color: var(--text-primary);
            overflow-x: hidden;
            transition: background 0.3s ease, color 0.3s ease;
        }
        
        .container {
            max-width: 600px;
            margin: 0 auto;
            background: var(--bg-card);
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 20px 60px var(--shadow-color);
            margin-bottom: 20px;
        }
        
        h1 {
            text-align: center;
            color: var(--button-primary);
            margin-bottom: 10px;
            font-size: 28px;
        }
        
        .date-display {
            text-align: center;
            color: var(--text-secondary);
            margin-bottom: 20px;
            font-size: 16px;
        }
        
        .date-display button {
            background: none;
            border: none;
            color: var(--button-primary);
            text-decoration: underline;
            cursor: pointer;
            font-size: 14px;
            margin-top: 5px;
            padding: 5px;
        }
        
        .category-buttons {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .category-btn {
            padding: 15px 10px;
            border: 2px solid var(--button-primary);
            background: var(--bg-card);
            border-radius: 12px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            color: var(--button-primary);
            touch-action: manipulation;
        }
        
        .category-btn:active, .category-btn.active {
            background: var(--button-primary);
            color: white;
            transform: scale(0.95);
        }
        
        .search-box {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--border-light);
            border-radius: 12px;
            font-size: 16px;
            margin-bottom: 15px;
        }
        
        .exercise-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 20px;
            max-height: 300px;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }
        
        .exercise-btn {
            padding: 12px;
            border: 2px solid var(--border-light);
            background: var(--bg-card);
            color: var(--text-primary);
            border-radius: 10px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
            text-align: left;
            touch-action: manipulation;
        }
        
        .exercise-btn:active {
            background: var(--border-color);
            transform: scale(0.98);
        }

        .exercise-btn.selected {
            background: var(--highlight-bg);
            border-color: var(--highlight-border);
            font-weight: bold;
            color: var(--text-primary);
        }
        
        .previous-data {
            background: var(--info-bg);
            padding: 12px;
            border-radius: 10px;
            margin: 15px 0;
            font-size: 14px;
        }
        
        .previous-data strong {
            color: var(--info-text);
        }

        .workout-history-item {
            background: var(--bg-card);
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 8px;
            border-left: 3px solid #1976d2;
        }

        .workout-history-item .date {
            font-weight: bold;
            color: var(--info-text);
            margin-bottom: 3px;
        }

        .workout-history-item .sets {
            color: var(--text-secondary);
            font-size: 13px;
        }

        .show-more-btn {
            width: 100%;
            padding: 8px;
            background: var(--bg-card);
            color: var(--info-text);
            border: 2px solid #1976d2;
            border-radius: 8px;
            font-size: 13px;
            cursor: pointer;
            margin-top: 8px;
            font-weight: bold;
        }

        .show-more-btn:active {
            background: var(--info-bg);
        }

        .cardio-form {
            background: var(--bg-card);
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
        }

        .cardio-field {
            margin-bottom: 12px;
        }

        .cardio-field label {
            display: block;
            font-weight: bold;
            color: var(--text-primary);
            margin-bottom: 5px;
            font-size: 14px;
        }

        .cardio-field input[type="text"] {
            width: 100%;
            padding: 10px;
            border: 2px solid var(--border-light);
            border-radius: 8px;
            font-size: 16px;
            box-sizing: border-box;
            background: var(--bg-card);
            color: var(--text-primary);
            transition: background 0.3s ease, color 0.3s ease, border-color 0.3s ease;
        }

        .cardio-field input[type="text"]:focus {
            outline: none;
            border-color: var(--button-primary);
        }

        .cardio-checkbox {
            display: flex;
            align-items: center;
            margin: 12px 0;
            padding: 10px;
            background: var(--border-color);
            border-radius: 8px;
        }

        .cardio-checkbox input[type="checkbox"] {
            width: 20px;
            height: 20px;
            margin-right: 10px;
            cursor: pointer;
        }

        .cardio-checkbox label {
            font-size: 14px;
            font-weight: bold;
            color: var(--text-primary);
            cursor: pointer;
        }

        .norwegian-rounds {
            margin-left: 30px;
            margin-top: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .norwegian-rounds input {
            width: 50px;
            padding: 8px;
            border: 2px solid var(--border-light);
            border-radius: 6px;
            font-size: 16px;
            text-align: center;
            background: var(--bg-card);
            color: var(--text-primary);
            transition: background 0.3s ease, color 0.3s ease, border-color 0.3s ease;
        }
        
        .norwegian-rounds input:focus {
            outline: none;
            border-color: var(--button-primary);
        }

        .norwegian-rounds span {
            font-size: 14px;
            color: var(--text-secondary);
        }

        .hidden {
            display: none;
        }
        
        .input-section {
            background: var(--info-bg);
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 20px;
            border: 2px solid var(--info-text);
            transition: background 0.3s ease, border-color 0.3s ease;
        }
        
        .input-section h3 {
            margin-bottom: 15px;
            color: var(--text-primary);
        }
        
        .quick-entry {
            margin-bottom: 15px;
        }
        
        .quick-entry input {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--border-light);
            border-radius: 10px;
            font-size: 18px;
            text-align: center;
            background: var(--bg-card);
            color: var(--text-primary);
            transition: background 0.3s ease, color 0.3s ease, border-color 0.3s ease;
        }
        
        .quick-entry input:focus {
            outline: none;
            border-color: var(--button-primary);
        }
        
        .quick-entry-hint {
            text-align: center;
            color: var(--text-secondary);
            font-size: 12px;
            margin-top: 5px;
        }
        
        .set-inputs {
            display: grid;
            gap: 10px;
        }
        
        .set-row {
            display: grid;
            grid-template-columns: 80px 1fr 60px;
            gap: 10px;
            align-items: center;
        }
        
        .set-row span {
            color: var(--text-primary);
            font-weight: 500;
        }
        
        .set-row input {
            padding: 10px;
            border: 2px solid var(--border-light);
            border-radius: 8px;
            font-size: 16px;
            background: var(--bg-card);
            color: var(--text-primary);
            transition: background 0.3s ease, color 0.3s ease, border-color 0.3s ease;
        }
        
        .set-row input:focus {
            outline: none;
            border-color: var(--button-primary);
        }
        
        .submit-btn {
            width: 100%;
            padding: 18px;
            background: #4caf50;
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 15px;
            touch-action: manipulation;
        }
        
        .submit-btn:active {
            background: #45a049;
            transform: scale(0.98);
        }
        
        .submit-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        
        .todays-workout {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 3px solid #eee;
        }
        
        .todays-workout h3 {
            color: var(--button-primary);
            margin-bottom: 15px;
        }
        
        .workout-item {
            background: #f8f9fa;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 10px;
            border-left: 4px solid #4caf50;
        }
        
        .workout-item strong {
            color: var(--text-primary);
            display: block;
            margin-bottom: 5px;
        }
        
        .workout-item span {
            color: var(--text-secondary);
            font-size: 14px;
        }
        
        .loading {
            text-align: center;
            padding: 20px;
            color: var(--button-primary);
        }
        
        .error {
            background: #ffebee;
            color: #c62828;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 15px;
        }
        
        .success {
            background: #e8f5e9;
            color: #2e7d32;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 15px;
        }

        .hidden {
            display: none;
        }

        .btn-secondary {
            padding: 10px;
            background: #6c757d;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            touch-action: manipulation;
        }

        .btn-secondary:active {
            transform: scale(0.95);
        }

        /* Delete Button Styles */
        .delete-btn {
            background: #ff5252;
            color: white;
            border: none;
            border-radius: 6px;
            padding: 6px 10px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s ease;
            min-width: 40px;
        }

        .delete-btn:hover {
            background: #ff1744;
            transform: scale(1.05);
        }

        .delete-btn:active {
            transform: scale(0.95);
        }

        /* Add button to add more sets */
        .add-set-btn {
            width: 100%;
            padding: 10px;
            background: var(--button-primary);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
            margin-top: 10px;
        }

        .clear-sets-btn {
            width: 100%;
            padding: 10px;
            background: var(--bg-card);
            color: #dc3545;
            border: 2px solid #dc3545;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
            margin-top: 10px;
            font-weight: bold;
        }

        .clear-sets-btn:active {
            background: #dc3545;
            color: white;
        }

        .end-workout-btn {
            width: 100%;
            padding: 15px;
            background: var(--bg-card);
            color: #dc3545;
            border: 2px solid #dc3545;
            border-radius: 12px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 20px;
            touch-action: manipulation;
        }

        .end-workout-btn:active {
            background: #dc3545;
            color: white;
        }

        .timer-display {
            text-align: center;
            padding: 10px;
            margin-top: 10px;
            font-size: 18px;
            color: var(--button-primary);
            font-weight: bold;
        }

        /* Tab Navigation */
        .tab-navigation {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .tab-btn {
            flex: 1;
            padding: 15px;
            background: var(--bg-card);
            color: var(--text-secondary);
            border: 2px solid var(--border-color);
            border-radius: 12px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .tab-btn:active {
            transform: scale(0.98);
        }

        .tab-btn.active {
            background: var(--button-primary);
            color: white;
            border-color: var(--button-primary);
        }

        /* Tab Content Containers */
        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Stats Container Styling */
        .stats-container {
            background: var(--bg-card);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
        }

        .stats-period-buttons {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }

        .period-btn {
            padding: 12px;
            background: var(--bg-card);
            color: var(--text-primary);
            border: 2px solid var(--border-color);
            border-radius: 10px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .period-btn:active {
            transform: scale(0.98);
        }

        .period-btn.active {
            background: var(--info-bg);
            border-color: var(--info-text);
            color: var(--info-text);
        }

        .stats-display {
            background: var(--info-bg);
            padding: 15px;
            border-radius: 10px;
            border: 2px solid var(--info-text);
        }

        .stats-display h3 {
            color: var(--info-text);
            margin-bottom: 15px;
            font-size: 18px;
        }

        .stats-placeholder {
            text-align: center;
            color: var(--text-secondary);
            padding: 40px 20px;
            font-size: 16px;
        }

        /* Mobile-specific adjustments for iPhone and small screens */
        @media (max-width: 600px) {
            /* Fix set-row layout to keep √ó buttons inside frame */
            .set-row {
                grid-template-columns: 50px 140px 50px;
                gap: 8px;
            }
            
            /* Ensure buttons don't overflow */
            .btn-secondary {
                min-width: 45px;
                width: 45px;
                padding: 8px 10px;
            }
            
            /* Adjust input padding for better mobile fit */
            .set-row input {
                padding: 10px 8px;
                font-size: 16px;
                width: 100%;
                max-width: 140px;
            }
            
            /* Keep everything contained within input-section */
            .input-section {
                padding: 12px;
                overflow: hidden;
            }
            
            /* Ensure set labels are readable but compact */
            .set-row span {
                font-size: 14px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div style="display: flex; justify-content: center; align-items: center; margin-bottom: 10px; position: relative;">
            <h1 style="margin: 0; padding: 0 55px;">üèãÔ∏è Workout Tracker</h1>
            <button onclick="toggleDarkMode()" style="background: var(--bg-card); border: 2px solid var(--border-color); border-radius: 50%; width: 44px; height: 44px; font-size: 20px; cursor: pointer; transition: all 0.3s ease; position: absolute; right: 0;" id="themeToggle">
                üåô
            </button>
        </div>
        <div class="date-display">
            <div id="currentDate"></div>
            <input type="date" id="datePicker" style="position: absolute; opacity: 0; pointer-events: none;">
            <button onclick="changeDatePicker()">Change Date</button>
        </div>

        <!-- Tab Navigation -->
        <div class="tab-navigation">
            <button class="tab-btn active" onclick="switchTab('today')" id="todayTab">
                üìù Today
            </button>
            <button class="tab-btn" onclick="switchTab('stats')" id="statsTab">
                üìä Stats
            </button>
        </div>

        <div id="message" class="hidden"></div>

        <!-- TODAY TAB CONTENT -->
        <div id="todayContent" class="tab-content active">

        <!-- Search Box -->
        <input type="text" class="search-box hidden" id="searchBox" placeholder="üîç Search exercises..." onkeyup="filterExercises()">

        <!-- Category Buttons -->
        <div class="category-buttons">
            <button class="category-btn" onclick="showCategory('Chest')">üí™ Chest</button>
            <button class="category-btn" onclick="showCategory('Back')">üîô Back</button>
            <button class="category-btn" onclick="showCategory('Arms')">üí™ Arms</button>
            <button class="category-btn" onclick="showCategory('Shoulders')">‚≠ê Shoulders</button>
            <button class="category-btn" onclick="showCategory('Legs')">ü¶µ Legs</button>
            <button class="category-btn" onclick="showCategory('Core')">‚≠ê Core</button>
            <button class="category-btn" onclick="showCategory('Cardio')">üèÉ Cardio</button>
            <button class="category-btn" onclick="showCategory('Other')">üîß Other</button>
        </div>

        <!-- Exercise Grid -->
        <div class="exercise-grid hidden" id="exerciseGrid"></div>

        <!-- Previous Data Display -->
        <div class="previous-data hidden" id="previousData"></div>

        <!-- Input Section -->
        <div class="input-section hidden" id="inputSection">
            <h3 id="selectedExercise"></h3>
            
            <div id="previousData" class="previous-data hidden"></div>
            
            <!-- Weight Training Input -->
            <div id="weightInput">
                <div class="quick-entry">
                    <input type="text" id="quickEntry" placeholder="e.g., 4@50 or 4@25/30/35/40">
                    <div class="quick-entry-hint">Quick entry: [sets]@[weight] or [sets]@[w1/w2/w3...]</div>
                </div>

                <div id="setInputs" class="set-inputs"></div>
                
                <button class="add-set-btn" onclick="addEmptySet()">+ Add Another Set</button>
                <button class="clear-sets-btn" onclick="clearAllSets()">üóëÔ∏è Clear All Sets</button>
            </div>

            <!-- Cardio Input -->
            <div id="cardioInput" class="cardio-form hidden">
                <div id="norwegianRoundsField" class="hidden" style="margin-bottom: 15px;">
                    <label style="display: block; font-weight: bold; color: var(--text-primary); margin-bottom: 5px; font-size: 14px;">Rounds:</label>
                    <div class="norwegian-rounds" style="margin-left: 0;">
                        <input type="text" id="norwegianSets" placeholder="4" maxlength="2">
                        <span>√ó</span>
                        <input type="text" id="norwegianMins" placeholder="4" maxlength="2">
                        <span>minutes</span>
                    </div>
                </div>

                <div class="cardio-field">
                    <label for="cardioDuration">Duration (MM:SS):</label>
                    <input type="text" id="cardioDuration" placeholder="e.g., 45:00">
                </div>

                <div class="cardio-field">
                    <label for="cardioDistance">Distance (miles):</label>
                    <input type="text" id="cardioDistance" placeholder="e.g., 5.0">
                </div>

                <div class="cardio-field">
                    <label for="cardioCalories">Calories:</label>
                    <input type="text" id="cardioCalories" placeholder="e.g., 650">
                </div>

                <div class="cardio-field">
                    <label for="cardioSpeed" id="cardioSpeedLabel">Speed:</label>
                    <input type="text" id="cardioSpeed" placeholder="e.g., 6.5">
                </div>

                <div class="cardio-checkbox">
                    <input type="checkbox" id="zone2Checkbox">
                    <label for="zone2Checkbox">Zone 2 workout</label>
                </div>

                <div class="cardio-field">
                    <label for="cardioNotes">Notes (optional):</label>
                    <input type="text" id="cardioNotes" placeholder="e.g., sprint stairs">
                </div>
            </div>

            <button class="submit-btn" onclick="submitWorkout()">‚úì SUBMIT</button>
        </div>

        <!-- Today's Workout Summary -->
        <div class="todays-workout">
            <h3>Today's Workout</h3>
            <div id="todaysSummary">
                <div style="color: var(--text-light); text-align: center; padding: 20px;">No exercises logged yet</div>
            </div>
            <div class="timer-display" id="timerDisplay">‚è±Ô∏è Gym time: 0:00</div>
            <button class="end-workout-btn hidden" id="endWorkoutBtn" onclick="endWorkoutSession()">üèÅ End Workout Session</button>
        </div>

        </div>
        <!-- END TODAY TAB CONTENT -->

        <!-- STATS TAB CONTENT -->
        <div id="statsContent" class="tab-content">
            <div class="stats-container">
                <h2 style="text-align: center; color: var(--text-primary); margin-bottom: 20px;">üìä Workout Statistics</h2>
                
                <!-- Period Selection Buttons -->
                <div class="stats-period-buttons">
                    <button class="period-btn active" onclick="showStatsPeriod('week')" id="weekBtn">
                        üìÖ This Week
                    </button>
                    <button class="period-btn" onclick="showStatsPeriod('month')" id="monthBtn">
                        üìÜ This Month
                    </button>
                    <button class="period-btn" onclick="showStatsPeriod('year')" id="yearBtn">
                        üìà This Year
                    </button>
                    <button class="period-btn" onclick="showStatsPeriod('lifetime')" id="lifetimeBtn">
                        üèÜ Lifetime
                    </button>
                </div>

                <!-- Stats Display Area -->
                <div class="stats-display">
                    <div id="statsDataDisplay">
                        <div class="stats-placeholder">
                            <h3>üìä This Week</h3>
                            <p style="margin-top: 20px;">Stats calculations coming soon!</p>
                            <p style="margin-top: 10px; font-size: 14px;">Your workout data will be analyzed and displayed here.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- END STATS TAB CONTENT -->

    </div>

    <script>
        // Configuration - UPDATE THIS WITH YOUR GOOGLE SHEET ID
        const SHEET_ID = '1BB8uGfrcD-rRtk9JzmXUqzwgcK2atycZorxCMjYQ2jw';
        const SHEET_NAME = 'Sheet1';
        
        // Exercise Database
        const EXERCISES = {
            'Chest': ['Flat Chest Press Dumbbell', 'Flat Chest Press Supine Machine', 'Flat Chest Press Barbell', 'Incline Chest Press Dumbbell', 'Incline Chest Press Machine', 'Chest Butterfly Machine'],
            'Back': ['Cable Row Linked - Narrow Grip', 'Cable Row Linked - Wide Grip', 'Cable Row Linked - W-Bar', 'Cable Row Linked - Medium Wide Grip', 'Double Cable Row Independent', 'Double Cable Row Linked - Narrow Grip', 'Dumbbell Row', 'Lat Pulldown', 'Pull-Ups Assisted', 'Pull-Ups Unassisted', 'Reverse Butterfly Machine'],
            'Arms': ['Bicep Curls Dumbbell', 'Bicep Curls EZ Bar', 'Bicep Curls Flat Bar', 'Bicep Hammer Curls', 'Bicep Preacher Curl Machine', 'Tricep Rope Pull', 'Tricep Skulls', 'Tricep Cable Pull V-Bar', 'Tricep Press Machine', 'Tricep Single Arm Cable Pull', 'Dips Assisted', 'Dumbbell Forearm Curls'],
            'Shoulders': ['Military Press Dumbbell', 'Shoulder Lateral Raises Dumbbell', 'Shoulder Lateral Raises Cable', 'Shoulder Front Raises Dumbbell', 'High Pulls Dumbbell', 'Rear Delt Cable Face Pulls'],
            'Legs': ['Goblet Squat Dumbbell', 'Hack Squat Machine', 'Leg Press Machine', 'Reverse Lunges Dumbbell', 'Bulgarian Split Squats Dumbbell'],
            'Core': ['Abs Leg Raises', 'Abs Crunches'],
            'Cardio': ['Treadmill', 'Outdoor Run', 'Stair Machine', 'Norwegian Intervals', 'Rowing Erg', 'Outdoor Hike'],
            'Other': ['Farmer\'s Carry with Shrugs', 'Suitcase Carry with Shrugs', 'Shrugs', 'Push-Ups', 'Dead-Hangs', 'Tricep Dips', 'Physical Therapy Workout', 'Cable Pull-Through Hinge', 'Sauna']
        };

        // State
        let currentDate = new Date();
        let selectedExercise = null;
        let selectedCategory = null;
        let todaysWorkouts = [];
        let setCounter = 0;
        let workoutStartTime = Date.now();
        let timerInterval = null;
        let previousWorkoutsToShow = 3;
        let darkMode = localStorage.getItem('darkMode') === 'true';

        // Initialize
        document.getElementById('currentDate').textContent = formatDate(currentDate);
        loadTodaysWorkouts();
        startTimer();
        initDarkMode();

        function formatDate(date) {
            const month = date.getMonth() + 1;
            const day = date.getDate();
            const year = date.getFullYear();
            return `üìÖ ${month}/${day}/${year}`;
        }

        function formatDateForSheet(date) {
            const month = date.getMonth() + 1;
            const day = date.getDate();
            const year = date.getFullYear();
            return `${month}/${day}/${year}`;
        }

        function initDarkMode() {
            if (darkMode) {
                document.documentElement.setAttribute('data-theme', 'dark');
                document.getElementById('themeToggle').textContent = '‚òÄÔ∏è';
            } else {
                document.documentElement.setAttribute('data-theme', 'light');
                document.getElementById('themeToggle').textContent = 'üåô';
            }
        }

        function toggleDarkMode() {
            darkMode = !darkMode;
            localStorage.setItem('darkMode', darkMode);
            
            if (darkMode) {
                document.documentElement.setAttribute('data-theme', 'dark');
                document.getElementById('themeToggle').textContent = '‚òÄÔ∏è';
            } else {
                document.documentElement.setAttribute('data-theme', 'light');
                document.getElementById('themeToggle').textContent = 'üåô';
            }
        }

        // Demo Workout Data for Stats (structured like CSV)
        const DEMO_WORKOUTS = [
            // Last 7 days
            { date: '12/12/2025', exercise: 'Flat Chest Press Dumbbell', category: 'Chest', sets: [50, 50, 50, 50] },
            { date: '12/12/2025', exercise: 'Cable Row Linked - Narrow Grip', category: 'Back', sets: [130, 145, 145, 130] },
            { date: '12/12/2025', exercise: 'Abs Crunches', category: 'Core', sets: ['BW', 'BW', 'BW', 'BW'] },
            { date: '12/10/2025', exercise: 'Treadmill', category: 'Cardio', distance: 5.0, duration: '45:00', calories: 650, zone2: true },
            { date: '12/9/2025', exercise: 'Military Press Dumbbell', category: 'Shoulders', sets: [30, 30, 30, 30] },
            { date: '12/9/2025', exercise: 'Bicep Curls EZ Bar', category: 'Arms', sets: [60, 60, 60, 60] },
            { date: '12/9/2025', exercise: 'Tricep Skulls', category: 'Arms', sets: [50, 50, 50, 50] },
            { date: '12/7/2025', exercise: 'Norwegian Intervals', category: 'Cardio', distance: 4.0, duration: '48:00', calories: 600, norwegian: true },
            { date: '12/6/2025', exercise: 'Lat Pulldown', category: 'Back', sets: [120, 120, 120, 120] },
            { date: '12/6/2025', exercise: 'Reverse Butterfly Machine', category: 'Back', sets: [100, 100, 100, 100] },
            
            // Last 30 days
            { date: '11/28/2025', exercise: 'Flat Chest Press Supine Machine', category: 'Chest', sets: [50, 50, 50, 50] },
            { date: '11/28/2025', exercise: 'Cable Row Linked - W-Bar', category: 'Back', sets: [100, 100, 100, 100] },
            { date: '11/25/2025', exercise: 'Norwegian Intervals', category: 'Cardio', distance: 4.05, duration: '48:00', calories: 600, norwegian: true },
            { date: '11/22/2025', exercise: 'Military Press Dumbbell', category: 'Shoulders', sets: [30, 30, 30, 30] },
            { date: '11/22/2025', exercise: 'Bicep Curls EZ Bar', category: 'Arms', sets: [60, 60, 60, 60] },
            { date: '11/15/2025', exercise: 'Hack Squat Machine', category: 'Legs', sets: [90, 90, 90, 90] },
            { date: '11/15/2025', exercise: 'Goblet Squat Dumbbell', category: 'Legs', sets: [30, 30, 30, 30] },
            
            // Last year
            { date: '6/15/2025', exercise: 'Flat Chest Press Dumbbell', category: 'Chest', sets: [65, 65, 65, 65] },
            { date: '3/20/2025', exercise: 'Outdoor Run', category: 'Cardio', distance: 5.1, duration: '39:00', calories: 700 },
            { date: '1/10/2025', exercise: 'Flat Chest Press Dumbbell', category: 'Chest', sets: [65, 65, 65, 65] }
        ];

        // Tab Switching
        let currentTab = 'today';
        let currentStatsPeriod = 'week';

        function switchTab(tabName) {
            // Update current tab
            currentTab = tabName;
            
            // Hide all tab contents
            document.getElementById('todayContent').classList.remove('active');
            document.getElementById('statsContent').classList.remove('active');
            
            // Remove active class from all tab buttons
            document.getElementById('todayTab').classList.remove('active');
            document.getElementById('statsTab').classList.remove('active');
            
            // Show selected tab content and activate button
            if (tabName === 'today') {
                document.getElementById('todayContent').classList.add('active');
                document.getElementById('todayTab').classList.add('active');
            } else if (tabName === 'stats') {
                document.getElementById('statsContent').classList.add('active');
                document.getElementById('statsTab').classList.add('active');
                // Render current stats period when switching to stats tab
                renderStatsPeriod(currentStatsPeriod);
            }
        }

        function showStatsPeriod(period) {
            // Update current period
            currentStatsPeriod = period;
            
            // Remove active class from all period buttons
            document.getElementById('weekBtn').classList.remove('active');
            document.getElementById('monthBtn').classList.remove('active');
            document.getElementById('yearBtn').classList.remove('active');
            document.getElementById('lifetimeBtn').classList.remove('active');
            
            // Activate selected button
            document.getElementById(period + 'Btn').classList.add('active');
            
            // Render the stats for this period
            renderStatsPeriod(period);
        }

        function renderStatsPeriod(period) {
            const display = document.getElementById('statsDataDisplay');
            
            // Calculate stats based on period
            let stats;
            let title = '';
            
            if (period === 'week') {
                stats = calculateWeekStats();
                title = 'üìÖ This Week';
            } else if (period === 'month') {
                stats = calculateMonthStats();
                title = 'üìÜ This Month';
            } else if (period === 'year') {
                stats = calculateYearStats();
                title = 'üìà This Year';
            } else if (period === 'lifetime') {
                stats = calculateLifetimeStats();
                title = 'üèÜ Lifetime Stats';
            }
            
            // Render the stats
            display.innerHTML = `
                <h3 style="color: var(--info-text); margin-bottom: 20px;">${title}</h3>
                
                <!-- Body Part Balance Section (MOVED TO TOP) -->
                <div style="background: var(--bg-card); padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                    <h4 style="color: var(--text-primary); margin-bottom: 15px;">üí™ Training Balance (Last 7 Days)</h4>
                    ${renderBodyPartBalance(7)}
                </div>
                
                <div style="background: var(--bg-card); padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                    <h4 style="color: var(--text-primary); margin-bottom: 15px;">üí™ Training Balance (Last 30 Days)</h4>
                    ${renderBodyPartBalance(30)}
                </div>
                
                <div style="background: var(--bg-card); padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                    <h4 style="color: var(--text-primary); margin-bottom: 10px;">üí™ Strength Training</h4>
                    <p style="color: var(--text-secondary); margin: 5px 0;">Workouts: <strong style="color: var(--text-primary);">${stats.strength.workouts}</strong></p>
                    <p style="color: var(--text-secondary); margin: 5px 0;">Total Sets: <strong style="color: var(--text-primary);">${stats.strength.totalSets}</strong></p>
                    <p style="color: var(--text-secondary); margin: 5px 0;">Est. Volume: <strong style="color: var(--text-primary);">${stats.strength.volume.toLocaleString()} lbs</strong></p>
                    ${stats.strength.topExercise ? `<p style="color: var(--text-secondary); margin: 5px 0;">Top Exercise: <strong style="color: var(--text-primary);">${stats.strength.topExercise}</strong></p>` : ''}
                </div>
                
                <div style="background: var(--bg-card); padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                    <h4 style="color: var(--text-primary); margin-bottom: 10px;">üèÉ Cardio</h4>
                    <p style="color: var(--text-secondary); margin: 5px 0;">Sessions: <strong style="color: var(--text-primary);">${stats.cardio.sessions}</strong></p>
                    <p style="color: var(--text-secondary); margin: 5px 0;">Total Miles: <strong style="color: var(--text-primary);">${stats.cardio.miles.toFixed(1)}</strong></p>
                    <p style="color: var(--text-secondary); margin: 5px 0;">Calories: <strong style="color: var(--text-primary);">${stats.cardio.calories.toLocaleString()}</strong></p>
                    <p style="color: var(--text-secondary); margin: 5px 0;">Zone 2: <strong style="color: var(--text-primary);">${stats.cardio.zone2Count} sessions</strong></p>
                    <p style="color: var(--text-secondary); margin: 5px 0;">Norwegian: <strong style="color: var(--text-primary);">${stats.cardio.norwegianCount} sessions</strong></p>
                </div>
                
                <div style="background: var(--bg-card); padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                    <h4 style="color: var(--text-primary); margin-bottom: 10px;">üìä Overall</h4>
                    <p style="color: var(--text-secondary); margin: 5px 0;">Total Workouts: <strong style="color: var(--text-primary);">${stats.overall.totalWorkouts}</strong></p>
                    <p style="color: var(--text-secondary); margin: 5px 0;">Most Trained: <strong style="color: var(--text-primary);">${stats.overall.topCategory}</strong></p>
                </div>
                
                <!-- Personal Records Section (MOVED TO BOTTOM) -->
                <div style="background: var(--bg-card); padding: 15px; border-radius: 8px;">
                    <h4 style="color: var(--text-primary); margin-bottom: 15px;">üèÜ Personal Records</h4>
                    ${renderPRs()}
                </div>
            `;
        }

        function renderPRs() {
            const prs = findPersonalRecords();
            
            // Group by category
            const groupedPRs = {};
            Object.keys(prs).forEach(exercise => {
                const category = prs[exercise].category;
                if (!groupedPRs[category]) groupedPRs[category] = [];
                groupedPRs[category].push({
                    exercise: exercise,
                    ...prs[exercise]
                });
            });
            
            let html = '';
            
            // Display PRs by category
            Object.keys(groupedPRs).sort().forEach(category => {
                const categoryEmoji = {
                    'Chest': 'üí™',
                    'Back': 'üîô',
                    'Arms': 'üí™',
                    'Shoulders': '‚≠ê',
                    'Legs': 'ü¶µ',
                    'Core': 'üî•'
                }[category] || 'üí™';
                
                html += `<div style="margin-bottom: 15px;">`;
                html += `<h5 style="color: var(--info-text); margin-bottom: 8px; font-size: 14px;">${categoryEmoji} ${category}</h5>`;
                
                groupedPRs[category].forEach(pr => {
                    const isNew = isNewPR(pr.date);
                    const prBadge = isNew ? ' <span style="background: #ff6b6b; color: white; padding: 2px 6px; border-radius: 4px; font-size: 11px; font-weight: bold;">üî• NEW PR!</span>' : '';
                    
                    html += `<p style="color: var(--text-secondary); margin: 4px 0; font-size: 13px;">
                        ${pr.exercise}: <strong style="color: var(--text-primary);">${pr.weight} lbs</strong> 
                        <span style="color: var(--text-light); font-size: 11px;">(${pr.date})</span>${prBadge}
                    </p>`;
                });
                
                html += `</div>`;
            });
            
            return html || '<p style="color: var(--text-secondary); font-size: 13px;">No PRs recorded yet.</p>';
        }

        function renderBodyPartBalance(days) {
            const balance = calculateBodyPartBalance(days);
            const { counts, maxSets } = balance;
            
            let html = '';
            
            // Order of body parts
            const order = ['Chest', 'Back', 'Arms', 'Shoulders', 'Legs', 'Core'];
            
            order.forEach(category => {
                const sets = counts[category];
                if (sets > 0 || maxSets > 0) {
                    const percentage = maxSets > 0 ? (sets / maxSets) * 100 : 0;
                    const isTop = sets === maxSets && sets > 0;
                    const isLow = sets < maxSets * 0.3 && maxSets > 0 && sets > 0;
                    
                    const badge = isTop ? ' üî•' : (isLow ? ' ‚ö†Ô∏è' : '');
                    
                    html += `<div style="margin-bottom: 12px;">`;
                    html += `<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px;">`;
                    html += `<span style="color: var(--text-primary); font-size: 13px; font-weight: 500;">${category}${badge}</span>`;
                    html += `<span style="color: var(--text-secondary); font-size: 13px;">${sets} sets</span>`;
                    html += `</div>`;
                    html += `<div style="background: var(--border-color); height: 8px; border-radius: 4px; overflow: hidden;">`;
                    html += `<div style="background: var(--button-primary); width: ${percentage}%; height: 100%; border-radius: 4px; transition: width 0.3s ease;"></div>`;
                    html += `</div>`;
                    html += `</div>`;
                }
            });
            
            return html || '<p style="color: var(--text-secondary); font-size: 13px;">No training data for this period.</p>';
        }

        // Stats Calculation Functions
        function calculateWeekStats() {
            const today = new Date();
            const weekAgo = new Date(today.getTime() - 7 * 24 * 60 * 60 * 1000);
            return calculateStatsForPeriod(weekAgo, today);
        }

        function calculateMonthStats() {
            const today = new Date();
            const monthAgo = new Date(today.getTime() - 30 * 24 * 60 * 60 * 1000);
            return calculateStatsForPeriod(monthAgo, today);
        }

        function calculateYearStats() {
            const today = new Date();
            const yearAgo = new Date(today.getTime() - 365 * 24 * 60 * 60 * 1000);
            return calculateStatsForPeriod(yearAgo, today);
        }

        function calculateLifetimeStats() {
            // For demo, use all data
            const earliest = new Date('2022-01-01');
            const today = new Date();
            return calculateStatsForPeriod(earliest, today);
        }

        function calculateStatsForPeriod(startDate, endDate) {
            // Filter workouts within date range
            const workouts = DEMO_WORKOUTS.filter(w => {
                const workoutDate = new Date(w.date);
                return workoutDate >= startDate && workoutDate <= endDate;
            });

            // Initialize stats
            const stats = {
                strength: {
                    workouts: 0,
                    totalSets: 0,
                    volume: 0,
                    topExercise: ''
                },
                cardio: {
                    sessions: 0,
                    miles: 0,
                    calories: 0,
                    zone2Count: 0,
                    norwegianCount: 0
                },
                overall: {
                    totalWorkouts: 0,
                    topCategory: ''
                }
            };

            // Count categories and exercises
            const categoryCount = {};
            const exerciseCount = {};
            const uniqueDates = new Set();

            workouts.forEach(w => {
                uniqueDates.add(w.date);

                if (w.category === 'Cardio') {
                    stats.cardio.sessions++;
                    stats.cardio.miles += w.distance || 0;
                    stats.cardio.calories += w.calories || 0;
                    if (w.zone2) stats.cardio.zone2Count++;
                    if (w.norwegian) stats.cardio.norwegianCount++;
                } else {
                    // Strength training
                    if (w.sets && Array.isArray(w.sets)) {
                        stats.strength.totalSets += w.sets.length;
                        
                        // Calculate volume (assume 8 reps per set)
                        w.sets.forEach(weight => {
                            if (weight !== 'BW' && !isNaN(weight)) {
                                stats.strength.volume += parseFloat(weight) * 8;
                            }
                        });
                    }

                    // Count exercise frequency
                    exerciseCount[w.exercise] = (exerciseCount[w.exercise] || 0) + 1;
                }

                // Count category frequency
                categoryCount[w.category] = (categoryCount[w.category] || 0) + 1;
            });

            // Calculate strength workouts (unique dates with strength exercises)
            stats.strength.workouts = workouts.filter(w => w.category !== 'Cardio').length > 0 ? 
                [...new Set(workouts.filter(w => w.category !== 'Cardio').map(w => w.date))].length : 0;

            // Find top exercise
            if (Object.keys(exerciseCount).length > 0) {
                stats.strength.topExercise = Object.keys(exerciseCount).reduce((a, b) => 
                    exerciseCount[a] > exerciseCount[b] ? a : b
                );
            }

            // Find top category
            if (Object.keys(categoryCount).length > 0) {
                stats.overall.topCategory = Object.keys(categoryCount).reduce((a, b) => 
                    categoryCount[a] > categoryCount[b] ? a : b
                );
            }

            stats.overall.totalWorkouts = uniqueDates.size;

            return stats;
        }

        // Personal Records (PRs) Detection
        function findPersonalRecords() {
            const prs = {};
            
            DEMO_WORKOUTS.forEach(w => {
                if (w.category !== 'Cardio' && w.sets && Array.isArray(w.sets)) {
                    w.sets.forEach(weight => {
                        if (weight !== 'BW' && !isNaN(weight)) {
                            const numWeight = parseFloat(weight);
                            
                            if (!prs[w.exercise]) {
                                prs[w.exercise] = {
                                    weight: numWeight,
                                    date: w.date,
                                    category: w.category
                                };
                            } else if (numWeight > prs[w.exercise].weight) {
                                prs[w.exercise] = {
                                    weight: numWeight,
                                    date: w.date,
                                    category: w.category
                                };
                            }
                        }
                    });
                }
            });
            
            return prs;
        }

        function isNewPR(prDate) {
            const pr = new Date(prDate);
            const today = new Date();
            const daysDiff = (today - pr) / (1000 * 60 * 60 * 24);
            return daysDiff <= 7;
        }

        // Body Part Balance Calculation
        function calculateBodyPartBalance(days) {
            const today = new Date();
            const startDate = new Date(today.getTime() - days * 24 * 60 * 60 * 1000);
            
            const categorySetCounts = {
                'Chest': 0,
                'Back': 0,
                'Arms': 0,
                'Shoulders': 0,
                'Legs': 0,
                'Core': 0,
                'Other': 0
            };
            
            DEMO_WORKOUTS.forEach(w => {
                const workoutDate = new Date(w.date);
                if (workoutDate >= startDate && workoutDate <= today) {
                    if (w.category !== 'Cardio' && w.sets && Array.isArray(w.sets)) {
                        const category = w.category;
                        if (categorySetCounts.hasOwnProperty(category)) {
                            categorySetCounts[category] += w.sets.length;
                        } else {
                            categorySetCounts['Other'] += w.sets.length;
                        }
                    }
                }
            });
            
            // Find max for scaling progress bars
            const maxSets = Math.max(...Object.values(categorySetCounts));
            
            return {
                counts: categorySetCounts,
                maxSets: maxSets
            };
        }

        function changeDatePicker() {
            const picker = document.getElementById('datePicker');
            
            // Set current date as default
            const year = currentDate.getFullYear();
            const month = String(currentDate.getMonth() + 1).padStart(2, '0');
            const day = String(currentDate.getDate()).padStart(2, '0');
            picker.value = `${year}-${month}-${day}`;
            
            // Trigger the date picker
            picker.style.opacity = '1';
            picker.style.pointerEvents = 'auto';
            picker.focus();
            picker.click();
            
            // Listen for date change
            picker.onchange = function() {
                if (picker.value) {
                    const parts = picker.value.split('-');
                    currentDate = new Date(parts[0], parts[1] - 1, parts[2]);
                    document.getElementById('currentDate').textContent = formatDate(currentDate);
                    loadTodaysWorkouts();
                }
                // Hide picker again
                picker.style.opacity = '0';
                picker.style.pointerEvents = 'none';
            };
        }

        function showCategory(category) {
            selectedCategory = category;
            const grid = document.getElementById('exerciseGrid');
            grid.innerHTML = '';
            grid.classList.remove('hidden');
            
            EXERCISES[category].forEach(exercise => {
                const btn = document.createElement('button');
                btn.className = 'exercise-btn';
                btn.textContent = exercise;
                btn.onclick = () => selectExercise(exercise, category);
                grid.appendChild(btn);
            });

            // Highlight active category
            document.querySelectorAll('.category-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
        }

        function selectExercise(exercise, category) {
            selectedExercise = exercise;
            selectedCategory = category;
            
            // Clear previous exercise highlights
            document.querySelectorAll('.exercise-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            
            // Highlight the clicked exercise
            event.target.classList.add('selected');
            
            document.getElementById('selectedExercise').textContent = exercise;
            document.getElementById('inputSection').classList.remove('hidden');
            
            // Check if this is a cardio exercise
            const isCardio = category === 'Cardio';
            
            if (isCardio) {
                // Show cardio form, hide weight form
                document.getElementById('weightInput').classList.add('hidden');
                document.getElementById('cardioInput').classList.remove('hidden');
                
                // Clear cardio fields
                document.getElementById('cardioDuration').value = '';
                document.getElementById('cardioDistance').value = '';
                document.getElementById('cardioCalories').value = '';
                document.getElementById('cardioSpeed').value = '';
                document.getElementById('cardioNotes').value = '';
                document.getElementById('zone2Checkbox').checked = false;
                document.getElementById('norwegianSets').value = '';
                document.getElementById('norwegianMins').value = '';
                
                // Show/hide Norwegian rounds field based on exercise
                const norwegianField = document.getElementById('norwegianRoundsField');
                if (exercise === 'Norwegian Intervals') {
                    norwegianField.classList.remove('hidden');
                } else {
                    norwegianField.classList.add('hidden');
                }
                
                // Customize speed/level label based on exercise
                const speedLabel = document.getElementById('cardioSpeedLabel');
                const speedInput = document.getElementById('cardioSpeed');
                
                if (exercise === 'Stair Machine') {
                    speedLabel.textContent = 'Level:';
                    speedInput.placeholder = 'e.g., 8';
                } else if (exercise === 'Outdoor Run' || exercise === 'Outdoor Hike') {
                    speedLabel.textContent = 'Pace:';
                    speedInput.placeholder = 'e.g., 7:30/mi';
                } else {
                    speedLabel.textContent = 'Speed:';
                    speedInput.placeholder = 'e.g., 6.5';
                }
                
                // Focus on duration field (or rounds if Norwegian)
                setTimeout(() => {
                    if (exercise === 'Norwegian Intervals') {
                        document.getElementById('norwegianSets').focus();
                    } else {
                        document.getElementById('cardioDuration').focus();
                    }
                }, 100);
                
            } else {
                // Show weight form, hide cardio form
                document.getElementById('weightInput').classList.remove('hidden');
                document.getElementById('cardioInput').classList.add('hidden');
                
                // Clear weight fields
                document.getElementById('quickEntry').value = '';
                document.getElementById('setInputs').innerHTML = '';
                setCounter = 0;
                
                // Add 4 empty sets by default
                for (let i = 0; i < 4; i++) {
                    addEmptySet();
                }
                
                // Focus on first weight input
                setTimeout(() => {
                    const firstInput = document.querySelector('#setInputs input');
                    if (firstInput) firstInput.focus();
                }, 100);
            }
            
            // Load previous workout data for this exercise
            loadPreviousData(exercise);
        }

        function loadPreviousData(exercise) {
            previousWorkoutsToShow = 3; // Reset to 3 when selecting new exercise
            const prevData = document.getElementById('previousData');
            prevData.classList.remove('hidden');
            prevData.innerHTML = `
                <strong>üìä Loading previous workouts...</strong>
                <div style="font-size: 12px; color: var(--text-secondary); margin-top: 5px;">
                    Checking your workout history...
                </div>
            `;
            
            // Fetch from Google Sheets
            fetchPreviousWorkouts(exercise);
        }

        async function fetchPreviousWorkouts(exercise) {
            try {
                // This will eventually use Google Sheets API
                // For now, show demo data with 9 workouts (can show 3, 6, or 9)
                
                // Simulate loading delay
                await new Promise(resolve => setTimeout(resolve, 500));
                
                // Demo data - 9 previous workouts
                const demoWorkouts = [
                    { date: '11/28/2025', sets: ['50', '50', '50', '50'] },
                    { date: '11/22/2025', sets: ['45', '45', '45', '45'] },
                    { date: '11/15/2025', sets: ['45', '45', '45', '50'] },
                    { date: '11/10/2025', sets: ['45', '45', '45', '45'] },
                    { date: '11/05/2025', sets: ['40', '40', '40', '40'] },
                    { date: '11/01/2025', sets: ['40', '40', '40', '45'] },
                    { date: '10/28/2025', sets: ['35', '35', '35', '35'] },
                    { date: '10/22/2025', sets: ['35', '35', '35', '40'] },
                    { date: '10/15/2025', sets: ['30', '30', '30', '30'] }
                ];
                
                displayPreviousWorkouts(demoWorkouts);
                
            } catch (error) {
                console.error('Error fetching previous data:', error);
                document.getElementById('previousData').innerHTML = `
                    <strong>‚ö†Ô∏è Could not load previous data</strong>
                    <div style="font-size: 12px;">Continue with your workout!</div>
                `;
            }
        }

        function displayPreviousWorkouts(workouts) {
            const prevData = document.getElementById('previousData');
            
            if (!workouts || workouts.length === 0) {
                prevData.innerHTML = `
                    <strong>üìä First time doing this exercise!</strong>
                    <div>No previous data found</div>
                `;
                return;
            }
            
            // Show only the number requested
            const workoutsToDisplay = workouts.slice(0, previousWorkoutsToShow);
            const hasMore = workouts.length > previousWorkoutsToShow;
            const canShowMore = previousWorkoutsToShow < 9 && hasMore;
            
            let html = '<strong>üìä Previous Workouts:</strong><div style="margin-top: 10px;">';
            
            workoutsToDisplay.forEach(workout => {
                html += `
                    <div class="workout-history-item">
                        <div class="date">${workout.date}</div>
                        <div class="sets">${workout.sets.length} sets @ ${workout.sets.join('/')}</div>
                    </div>
                `;
            });
            
            html += '</div>';
            
            // Add "Show More" button if there are more workouts
            if (canShowMore) {
                const remaining = Math.min(3, workouts.length - previousWorkoutsToShow);
                html += `<button class="show-more-btn" onclick="showMoreWorkouts()">Show ${remaining} More...</button>`;
            }
            
            prevData.innerHTML = html;
        }

        function showMoreWorkouts() {
            // Increase by 3
            previousWorkoutsToShow += 3;
            
            // Re-fetch and display (in production, this would use cached data)
            fetchPreviousWorkouts(selectedExercise);
        }

        document.getElementById('quickEntry').addEventListener('input', function(e) {
            const value = e.target.value;
            if (value.includes('@')) {
                parseQuickEntry(value);
            }
        });

        function parseQuickEntry(input) {
            const setInputs = document.getElementById('setInputs');
            setInputs.innerHTML = '';
            setCounter = 0;
            
            // Check if just a number (e.g., "4" = 4 sets, no weight)
            if (/^\d+$/.test(input)) {
                const numSets = parseInt(input);
                for (let i = 0; i < numSets; i++) {
                    addSetRow('');
                }
                return;
            }
            
            // Parse formats like "4@50" or "4@25/30/35/40"
            const match = input.match(/(\d+)@(.+)/);
            if (!match) return;
            
            const numSets = parseInt(match[1]);
            const weights = match[2].split('/').map(w => w.trim());
            
            for (let i = 0; i < numSets; i++) {
                const weight = weights.length === 1 ? weights[0] : (weights[i] || '');
                addSetRow(weight);
            }
        }

        function addEmptySet() {
            addSetRow('');
        }

        function addSetRow(weight = '') {
            setCounter++;
            const setInputs = document.getElementById('setInputs');
            const row = document.createElement('div');
            row.className = 'set-row';
            row.id = `set-${setCounter}`;
            row.innerHTML = `
                <span>Set ${setCounter}</span>
                <input type="number" step="0.5" placeholder="Weight (lbs)" value="${weight}" data-set="${setCounter}">
                <button class="btn-secondary" onclick="removeSet(${setCounter})">‚úï</button>
            `;
            setInputs.appendChild(row);
        }

        function removeSet(setNum) {
            const row = document.getElementById(`set-${setNum}`);
            if (row) {
                row.remove();
                renumberSets();
            }
        }

        function renumberSets() {
            const rows = document.querySelectorAll('.set-row');
            setCounter = 0;
            rows.forEach((row, index) => {
                setCounter++;
                row.id = `set-${setCounter}`;
                const label = row.querySelector('span');
                const button = row.querySelector('button');
                if (label) {
                    label.textContent = `Set ${index + 1}`;
                }
                if (button) {
                    button.onclick = () => removeSet(setCounter);
                }
            });
        }

        async function submitWorkout() {
            if (!selectedExercise) return;
            
            const isCardio = selectedCategory === 'Cardio';
            let workoutData = {};
            
            if (isCardio) {
                // Collect cardio data
                const duration = document.getElementById('cardioDuration').value.trim();
                const distance = document.getElementById('cardioDistance').value.trim();
                const calories = document.getElementById('cardioCalories').value.trim();
                const speed = document.getElementById('cardioSpeed').value.trim();
                const zone2 = document.getElementById('zone2Checkbox').checked;
                const norwegianSets = document.getElementById('norwegianSets').value.trim();
                const norwegianMins = document.getElementById('norwegianMins').value.trim();
                const notes = document.getElementById('cardioNotes').value.trim();
                
                // Check if this is Norwegian Intervals
                const isNorwegian = selectedExercise === 'Norwegian Intervals';
                
                // Build notes field (include Norwegian rounds if applicable)
                let finalNotes = notes;
                if (isNorwegian && norwegianSets && norwegianMins) {
                    const roundsText = `${norwegianSets}x${norwegianMins}`;
                    finalNotes = finalNotes ? `${roundsText} - ${notes}` : roundsText;
                }
                
                workoutData = {
                    date: formatDateForSheet(currentDate),
                    exercise: selectedExercise,
                    category: 'Cardio',
                    distance: distance,
                    duration: duration,
                    calories: calories,
                    speed_pace: speed,
                    zone_2: zone2 ? 'Yes' : 'No',
                    norwegian_sprints: isNorwegian ? 'Yes' : 'No',
                    notes: finalNotes
                };
                
                // Build display text for summary
                const displayParts = [];
                if (duration) displayParts.push(duration);
                if (distance) displayParts.push(`${distance} mi`);
                if (calories) displayParts.push(`${calories} cal`);
                
                todaysWorkouts.push({
                    exercise: selectedExercise,
                    cardio: true,
                    displayText: displayParts.join(', '),
                    zone2: zone2,
                    norwegian: isNorwegian
                });
                
            } else {
                // Weight training - check individual boxes FIRST, then quick entry
                const inputs = Array.from(document.querySelectorAll('#setInputs input'));
                const boxValues = inputs
                    .map(input => input.value.trim())
                    .filter(val => val !== '');
                
                let sets = [];
                
                // Priority 1: If ANY boxes have values, use those
                if (boxValues.length > 0) {
                    sets = boxValues;
                } else {
                    // Priority 2: Fall back to quick entry if boxes are empty
                    const quickEntryValue = document.getElementById('quickEntry').value.trim();
                    
                    if (quickEntryValue) {
                        // Parse the quick entry
                        if (/^\d+$/.test(quickEntryValue)) {
                            const numSets = parseInt(quickEntryValue);
                            sets = new Array(numSets).fill('BW');
                        } else if (quickEntryValue.includes('@')) {
                            const match = quickEntryValue.match(/(\d+)@(.+)/);
                            if (match) {
                                const numSets = parseInt(match[1]);
                                const weights = match[2].split('/').map(w => w.trim());
                                
                                for (let i = 0; i < numSets; i++) {
                                    const weight = weights.length === 1 ? weights[0] : (weights[i] || '');
                                    sets.push(weight);
                                }
                            }
                        }
                    }
                }
                
                if (sets.length === 0) {
                    showMessage('Please enter workout data!', 'error');
                    return;
                }
                
                workoutData = {
                    date: formatDateForSheet(currentDate),
                    exercise: selectedExercise,
                    category: selectedCategory,
                    sets: sets
                };
                
                const displaySets = sets.map(s => s === 'BW' ? '' : s).filter(s => s !== '');
                todaysWorkouts.push({
                    exercise: selectedExercise,
                    sets: sets,
                    displaySets: displaySets.length > 0 ? displaySets : ['bodyweight']
                });
            }
            
            showMessage('Saving to Google Sheets...', 'loading');
            
            try {
                // In a real implementation, this would use Google Sheets API
                console.log('Would save:', workoutData);
                
                // Simulate API delay
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                showMessage('‚úì Saved successfully!', 'success');
                
                updateTodaysSummary();
                
                // Reset form
                document.getElementById('inputSection').classList.add('hidden');
                document.getElementById('previousData').classList.add('hidden');
                document.getElementById('quickEntry').value = '';
                document.getElementById('setInputs').innerHTML = '';
                document.getElementById('exerciseGrid').classList.add('hidden');
                selectedExercise = null;
                setCounter = 0;
                
                // Clear category selection
                document.querySelectorAll('.category-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                
                // Clear exercise selection
                document.querySelectorAll('.exercise-btn').forEach(btn => {
                    btn.classList.remove('selected');
                });
                
            } catch (error) {
                showMessage('Error saving: ' + error.message, 'error');
            }
        }

        function loadTodaysWorkouts() {
            // This will load today's workouts from Google Sheets in production
            todaysWorkouts = [];
            updateTodaysSummary();
        }

        function updateTodaysSummary() {
            const summary = document.getElementById('todaysSummary');
            const endBtn = document.getElementById('endWorkoutBtn');
            
            if (todaysWorkouts.length === 0) {
                summary.innerHTML = '<div style="color: var(--text-light); text-align: center; padding: 20px;">No exercises logged yet</div>';
                endBtn.classList.add('hidden');
                return;
            }
            
            // Show end workout button
            endBtn.classList.remove('hidden');
            
            summary.innerHTML = todaysWorkouts.map((workout, index) => {
                // Check if cardio workout
                if (workout.cardio) {
                    let badges = '';
                    if (workout.zone2) badges += ' <span style="background: #4caf50; color: white; padding: 2px 6px; border-radius: 4px; font-size: 11px;">Z2</span>';
                    if (workout.norwegian) badges += ' <span style="background: #ff5722; color: white; padding: 2px 6px; border-radius: 4px; font-size: 11px;">üî•</span>';
                    
                    return `
                        <div class="workout-item" style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <strong>${workout.exercise}${badges}</strong>
                                <span>${workout.displayText}</span>
                            </div>
                            <button onclick="confirmDeleteExercise(${index})" class="delete-btn">
                                üóëÔ∏è
                            </button>
                        </div>
                    `;
                }
                
                // Weight training workout
                const displaySets = workout.displaySets || workout.sets;
                const setCount = workout.sets.length;
                
                // If all bodyweight, show "4 sets"
                if (displaySets.length === 1 && displaySets[0] === 'bodyweight') {
                    return `
                        <div class="workout-item" style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <strong>${workout.exercise}</strong>
                                <span>${setCount} sets</span>
                            </div>
                            <button onclick="confirmDeleteExercise(${index})" class="delete-btn">
                                üóëÔ∏è
                            </button>
                        </div>
                    `;
                }
                
                // Otherwise show weights
                return `
                    <div class="workout-item" style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <strong>${workout.exercise}</strong>
                            <span>${setCount} sets @ ${displaySets.join('/')} lbs</span>
                        </div>
                        <button onclick="confirmDeleteExercise(${index})" class="delete-btn">
                            üóëÔ∏è
                        </button>
                    </div>
                `;
            }).join('');
            
            // Count total sets (only for weight training)
            const totalSets = todaysWorkouts.reduce((sum, w) => {
                return sum + (w.sets ? w.sets.length : 0);
            }, 0);
            
            summary.innerHTML += `
                <div style="text-align: center; margin-top: 15px; padding-top: 15px; border-top: 2px solid #eee; font-weight: bold; color: var(--button-primary);">
                    Total: ${todaysWorkouts.length} exercises${totalSets > 0 ? `, ${totalSets} sets` : ''}
                </div>
            `;
        }

        // Delete Exercise Functions
        function confirmDeleteExercise(index) {
            const workout = todaysWorkouts[index];
            
            // Build confirmation message
            let message = `Delete this exercise?\n\n${workout.exercise}\n`;
            
            if (workout.cardio) {
                message += workout.displayText;
            } else if (workout.sets) {
                const setCount = workout.sets.length;
                const displaySets = workout.displaySets || workout.sets;
                
                if (displaySets.length === 1 && displaySets[0] === 'bodyweight') {
                    message += `${setCount} sets (bodyweight)`;
                } else {
                    message += `${setCount} sets @ ${displaySets.join('/')} lbs`;
                }
            }
            
            message += '\n\nThis will be permanently removed.';
            
            // Show confirmation dialog
            if (confirm(message)) {
                deleteExercise(index);
            }
        }

        function deleteExercise(index) {
            const workout = todaysWorkouts[index];
            
            // TODO: When Google Sheets is connected, delete rows from spreadsheet here
            // For now, we'll add a placeholder comment
            
            // FUTURE: Delete from Google Sheets
            // await deleteFromGoogleSheets(workout, currentDate);
            
            // Remove from today's workouts array
            todaysWorkouts.splice(index, 1);
            
            // Update the display
            updateTodaysSummary();
            
            // Show success message
            showMessage(`‚úì ${workout.exercise} deleted`, 'success');
            
            // Timer continues running - user may want to re-log corrected exercise
        }

        function showMessage(text, type) {
            const msg = document.getElementById('message');
            msg.className = type;
            msg.textContent = text;
            msg.classList.remove('hidden');
            
            if (type === 'success' || type === 'error') {
                setTimeout(() => {
                    msg.classList.add('hidden');
                }, 3000);
            }
        }

        function filterExercises() {
            const search = document.getElementById('searchBox').value.toLowerCase();
            if (search.length < 2) return;
            
            const grid = document.getElementById('exerciseGrid');
            grid.innerHTML = '';
            grid.classList.remove('hidden');
            
            Object.keys(EXERCISES).forEach(category => {
                EXERCISES[category].forEach(exercise => {
                    if (exercise.toLowerCase().includes(search)) {
                        const btn = document.createElement('button');
                        btn.className = 'exercise-btn';
                        btn.textContent = exercise;
                        btn.onclick = () => selectExercise(exercise, category);
                        grid.appendChild(btn);
                    }
                });
            });
        }

        // Service Worker registration for PWA
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('sw.js').catch(() => {
                console.log('Service Worker registration failed');
            });
        }

        // Timer functions
        function startTimer() {
            workoutStartTime = Date.now();
            timerInterval = setInterval(updateTimer, 1000);
        }

        function updateTimer() {
            const elapsed = Math.floor((Date.now() - workoutStartTime) / 1000);
            const minutes = Math.floor(elapsed / 60);
            const seconds = elapsed % 60;
            document.getElementById('timerDisplay').textContent = 
                `‚è±Ô∏è Gym time: ${minutes}:${seconds.toString().padStart(2, '0')}`;
        }

        function stopTimer() {
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }
        }

        function clearAllSets() {
            const inputs = document.querySelectorAll('#setInputs input');
            inputs.forEach(input => input.value = '');
            if (inputs.length > 0) {
                inputs[0].focus();
            }
        }

        function endWorkoutSession() {
            if (todaysWorkouts.length === 0) {
                return;
            }

            if (confirm('End your workout session? This will clear today\'s view (data is already saved).')) {
                // Clear today's workouts
                todaysWorkouts = [];
                updateTodaysSummary();
                
                // Hide end workout button
                document.getElementById('endWorkoutBtn').classList.add('hidden');
                
                // Reset timer
                stopTimer();
                startTimer();
                
                // Clear input section
                document.getElementById('inputSection').classList.add('hidden');
                document.getElementById('previousData').classList.add('hidden');
                document.getElementById('exerciseGrid').classList.add('hidden');
                
                // Clear category selection
                document.querySelectorAll('.category-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                
                // Clear exercise selection
                document.querySelectorAll('.exercise-btn').forEach(btn => {
                    btn.classList.remove('selected');
                });
                
                selectedExercise = null;
                selectedCategory = null;
                
                showMessage('‚úì Workout session ended! Ready for next workout.', 'success');
            }
        }

        // Check for midnight and auto-reset
        setInterval(() => {
            const now = new Date();
            if (now.getHours() === 0 && now.getMinutes() === 0 && now.getSeconds() === 0) {
                if (todaysWorkouts.length > 0) {
                    todaysWorkouts = [];
                    updateTodaysSummary();
                    document.getElementById('endWorkoutBtn').classList.add('hidden');
                    stopTimer();
                    startTimer();
                    showMessage('üåÖ New day! Workout log reset.', 'success');
                }
            }
        }, 1000);
    </script>
</body>
</html>
